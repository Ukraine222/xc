<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Онлайн шашки</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .screens {
            position: relative;
            min-height: 500px;
        }
        
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .active {
            display: flex;
        }
        
        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        .room-url {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        
        .url-container {
            display: flex;
            width: 100%;
            max-width: 500px;
        }
        
        #roomUrl {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 50px 0 0 50px;
            font-size: 0.9rem;
        }
        
        #copyUrl {
            border-radius: 0 50px 50px 0;
            padding: 10px 15px;
        }
        
        .checkers-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            width: min(90vw, 500px);
            height: min(90vw, 500px);
            border: 5px solid #3d3d3d;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            margin: 0 auto;
        }
        
        .cell {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .dark {
            background-color: #8B4513;
        }
        
        .light {
            background-color: #f0d9b5;
        }
        
        .checker {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .checker.player1 {
            background: linear-gradient(135deg, #ff6b6b 0%, #c0392b 100%);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        
        .checker.player2 {
            background: linear-gradient(135deg, #2e86de 0%, #1c5cb7 100%);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        
        .checker.king::after {
            content: "♛";
            font-size: 24px;
            color: gold;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }
        
        .selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 3px gold, 0 3px 10px rgba(0, 0, 0, 0.5);
        }
        
        .possible-move {
            position: relative;
        }
        
        .possible-move::after {
            content: "";
            position: absolute;
            width: 30%;
            height: 30%;
            background-color: rgba(0, 255, 0, 0.5);
            border-radius: 50%;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-top: 15px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        
        .player-turn {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .turn-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .turn-player1 {
            background: linear-gradient(135deg, #ff6b6b 0%, #c0392b 100%);
        }
        
        .turn-player2 {
            background: linear-gradient(135deg, #2e86de 0%, #1c5cb7 100%);
        }
        
        .waiting {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .container {
                padding: 15px;
            }
            
            button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .game-info {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Онлайн Шашки</h1>
        
        <div class="screens">
            <div class="screen active" id="mainScreen">
                <button id="createRoomBtn">Создать комнату</button>
                <button id="joinRoomBtn">Присоединиться к комнате</button>
            </div>
            
            <div class="screen" id="createRoomScreen">
                <h2>Комната создана!</h2>
                <p>Отправьте эту ссылку другу:</p>
                <div class="room-url">
                    <div class="url-container">
                        <input type="text" id="roomUrl" readonly>
                        <button id="copyUrl">Копировать</button>
                    </div>
                </div>
                <div class="waiting" id="waitingMessage">Ожидание соперника...</div>
                <button id="startGameBtn" style="display:none;">Начать игру</button>
            </div>
            
            <div class="screen" id="joinRoomScreen">
                <h2>Присоединиться к комнате</h2>
                <p>Введите ссылку приглашения:</p>
                <div class="room-url">
                    <div class="url-container">
                        <input type="text" id="joinRoomUrl" placeholder="Вставьте ссылку комнаты">
                        <button id="connectToRoom">Присоединиться</button>
                    </div>
                </div>
            </div>
            
            <div class="screen" id="gameScreen">
                <div class="game-info">
                    <div class="player-turn">
                        <span>Ход:</span>
                        <div class="turn-indicator turn-player1" id="turnIndicator"></div>
                        <span id="playerTurnText">Игрок 1</span>
                    </div>
                    <div id="playerInfo">Вы: Игрок 1</div>
                </div>
                
                <div class="checkers-board" id="checkersBoard"></div>
                
                <button id="backToMain" style="margin-top: 20px;">В главное меню</button>
            </div>
        </div>
    </div>

    <script>
        // Эмуляция WebSocket соединения (в реальном приложении нужно использовать настоящий WebSocket)
        class WebSocketSimulator {
            constructor() {
                this.listeners = {
                    open: [],
                    message: [],
                    close: []
                };
                this.connected = false;
                this.roomId = null;
            }
            
            connect(roomId) {
                this.roomId = roomId;
                setTimeout(() => {
                    this.connected = true;
                    this.listeners.open.forEach(callback => callback());
                }, 500);
            }
            
            send(data) {
                console.log("Отправлено:", data);
                // В реальном приложении здесь будут отправляться данные на сервер
                // Для демонстрации просто эмулируем ответ
                if (data.type === "join") {
                    setTimeout(() => {
                        this.listeners.message.forEach(callback => callback({
                            data: JSON.stringify({
                                type: "game_start",
                                player: Math.random() > 0.5 ? 1 : 2,
                                board: createInitialBoard()
                            })
                        }));
                    }, 1000);
                } else if (data.type === "move") {
                    // Эмулируем ответ о успешном ходе
                    setTimeout(() => {
                        this.listeners.message.forEach(callback => callback({
                            data: JSON.stringify({
                                type: "move_made",
                                board: data.board,
                                currentPlayer: data.currentPlayer === 1 ? 2 : 1
                            })
                        }));
                    }, 500);
                }
            }
            
            on(event, callback) {
                if (this.listeners[event]) {
                    this.listeners[event].push(callback);
                }
            }
            
            close() {
                this.connected = false;
                this.listeners.close.forEach(callback => callback());
            }
        }

        // Глобальные переменные
        let socket;
        let currentPlayer = 1;
        let playerNumber = 1;
        let selectedChecker = null;
        let board = [];
        
        // Элементы DOM
        const mainScreen = document.getElementById('mainScreen');
        const createRoomScreen = document.getElementById('createRoomScreen');
        const joinRoomScreen = document.getElementById('joinRoomScreen');
        const gameScreen = document.getElementById('gameScreen');
        const roomUrl = document.getElementById('roomUrl');
        const joinRoomUrl = document.getElementById('joinRoomUrl');
        const waitingMessage = document.getElementById('waitingMessage');
        const startGameBtn = document.getElementById('startGameBtn');
        const checkersBoard = document.getElementById('checkersBoard');
        const playerTurnText = document.getElementById('playerTurnText');
        const turnIndicator = document.getElementById('turnIndicator');
        const playerInfo = document.getElementById('playerInfo');
        
        // Инициализация игры
        function init() {
            // Создаем игровое поле
            createBoard();
            
            // Назначаем обработчики событий
            document.getElementById('createRoomBtn').addEventListener('click', createRoom);
            document.getElementById('joinRoomBtn').addEventListener('click', showJoinRoomScreen);
            document.getElementById('copyUrl').addEventListener('click', copyRoomUrl);
            document.getElementById('connectToRoom').addEventListener('click', joinRoom);
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('backToMain').addEventListener('click', backToMain);
        }
        
        // Создание игровой комнаты
        function createRoom() {
            const roomId = generateRoomId();
            roomUrl.value = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
            
            // Подключаемся к "серверу"
            socket = new WebSocketSimulator();
            socket.connect(roomId);
            
            socket.on('open', () => {
                showScreen(createRoomScreen);
                socket.send({ type: 'create', room: roomId });
            });
            
            socket.on('message', (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'game_start') {
                    playerNumber = data.player;
                    playerInfo.textContent = `Вы: Игрок ${playerNumber}`;
                    waitingMessage.style.display = 'none';
                    startGameBtn.style.display = 'block';
                } else if (data.type === 'move_made') {
                    updateBoard(data.board);
                    currentPlayer = data.currentPlayer;
                    updateTurnIndicator();
                }
            });
        }
        
        // Показать экран присоединения к комнате
        function showJoinRoomScreen() {
            showScreen(joinRoomScreen);
        }
        
        // Присоединиться к комнате
        function joinRoom() {
            const url = joinRoomUrl.value;
            const roomId = extractRoomIdFromUrl(url);
            
            if (!roomId) {
                alert('Неверная ссылка комнаты');
                return;
            }
            
            // Подключаемся к "серверу"
            socket = new WebSocketSimulator();
            socket.connect(roomId);
            
            socket.on('open', () => {
                socket.send({ type: 'join', room: roomId });
                showScreen(createRoomScreen);
                waitingMessage.textContent = 'Подключение к комнате...';
            });
            
            socket.on('message', (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'game_start') {
                    playerNumber = data.player;
                    playerInfo.textContent = `Вы: Игрок ${playerNumber}`;
                    updateBoard(data.board);
                    showScreen(gameScreen);
                    updateTurnIndicator();
                } else if (data.type === 'move_made') {
                    updateBoard(data.board);
                    currentPlayer = data.currentPlayer;
                    updateTurnIndicator();
                }
            });
        }
        
        // Начать игру
        function startGame() {
            board = createInitialBoard();
            renderBoard();
            showScreen(gameScreen);
            updateTurnIndicator();
        }
        
        // Создание начальной доски
        function createInitialBoard() {
            const board = Array(8).fill().map(() => Array(8).fill(null));
            
            // Расставляем шашки
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    if ((row + col) % 2 === 1) {
                        if (row < 3) {
                            board[row][col] = { player: 2, king: false };
                        } else if (row > 4) {
                            board[row][col] = { player: 1, king: false };
                        }
                    }
                }
            }
            
            return board;
        }
        
        // Создание DOM-структуры доски
        function createBoard() {
            checkersBoard.innerHTML = '';
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.classList.add((row + col) % 2 === 0 ? 'light' : 'dark');
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    cell.addEventListener('click', () => handleCellClick(row, col));
                    
                    checkersBoard.appendChild(cell);
                }
            }
        }
        
        // Отрисовка доски с шашками
        function renderBoard() {
            const cells = checkersBoard.querySelectorAll('.cell');
            cells.forEach(cell => {
                // Очищаем ячейку от предыдущих шашек
                const checker = cell.querySelector('.checker');
                if (checker) {
                    cell.removeChild(checker);
                }
                
                cell.classList.remove('selected', 'possible-move');
                
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                if (board[row][col]) {
                    const checkerElem = document.createElement('div');
                    checkerElem.classList.add('checker', `player${board[row][col].player}`);
                    
                    if (board[row][col].king) {
                        checkerElem.classList.add('king');
                    }
                    
                    cell.appendChild(checkerElem);
                }
            });
        }
        
        // Обновление доски на основе полученных данных
        function updateBoard(newBoard) {
            board = newBoard;
            renderBoard();
        }
        
        // Обработка клика по ячейке
        function handleCellClick(row, col) {
            // Если не ваш ход, ничего не делаем
            if (currentPlayer !== playerNumber) {
                return;
            }
            
            // Если ячейка содержит шашку текущего игрока
            if (board[row][col] && board[row][col].player === playerNumber) {
                selectChecker(row, col);
            } 
            // Если ячейка уже выбрана, пытаемся сделать ход
            else if (selectedChecker) {
                moveChecker(row, col);
            }
        }
        
        // Выбор шашки
        function selectChecker(row, col) {
            // Снимаем предыдущее выделение
            clearSelection();
            
            // Выделяем новую шашку
            selectedChecker = { row, col };
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('selected');
            
            // Показываем возможные ходы (упрощенная версия)
            showPossibleMoves(row, col);
        }
        
        // Показать возможные ходы
        function showPossibleMoves(row, col) {
            // Упрощенная реализация - в реальной игре нужно рассчитывать правильные ходы
            const directions = [];
            
            if (board[row][col].king) {
                directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
            } else if (board[row][col].player === 1) {
                directions.push([-1, -1], [-1, 1]);
            } else {
                directions.push([1, -1], [1, 1]);
            }
            
            for (const [dr, dc] of directions) {
                const newRow = row + dr;
                const newCol = col + dc;
                
                if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                    if (!board[newRow][newCol]) {
                        const cell = document.querySelector(`.cell[data-row="${newRow}"][data-col="${newCol}"]`);
                        cell.classList.add('possible-move');
                    }
                }
            }
        }
        
        // Очистка выделения
        function clearSelection() {
            const selected = document.querySelectorAll('.selected, .possible-move');
            selected.forEach(el => {
                el.classList.remove('selected', 'possible-move');
            });
            selectedChecker = null;
        }
        
        // Ход шашкой
        function moveChecker(toRow, toCol) {
            if (!selectedChecker) return;
            
            const fromRow = selectedChecker.row;
            const fromCol = selectedChecker.col;
            
            // Проверяем, что ход valid (упрощенная проверка)
            const rowDiff = toRow - fromRow;
            const colDiff = toCol - fromCol;
            
            // Простая проверка для демонстрации
            if (Math.abs(rowDiff) === 1 && Math.abs(colDiff) === 1) {
                // Делаем ход
                board[toRow][toCol] = board[fromRow][fromCol];
                board[fromRow][fromCol] = null;
                
                // Проверяем, стала ли шашка дамкой
                if ((playerNumber === 1 && toRow === 0) || (playerNumber === 2 && toRow === 7)) {
                    board[toRow][toCol].king = true;
                }
                
                // Отправляем ход на сервер
                socket.send({
                    type: 'move',
                    from: { row: fromRow, col: fromCol },
                    to: { row: toRow, col: toCol },
                    board: board,
                    currentPlayer: currentPlayer
                });
                
                // Обновляем доску
                renderBoard();
                clearSelection();
            }
        }
        
        // Обновление индикатора хода
        function updateTurnIndicator() {
            playerTurnText.textContent = `Игрок ${currentPlayer}`;
            turnIndicator.className = 'turn-indicator';
            turnIndicator.classList.add(currentPlayer === 1 ? 'turn-player1' : 'turn-player2');
        }
        
        // Копирование ссылки комнаты
        function copyRoomUrl() {
            roomUrl.select();
            document.execCommand('copy');
            alert('Ссылка скопирована в буфер обмена!');
        }
        
        // Возврат в главное меню
        function backToMain() {
            if (socket) {
                socket.close();
            }
            showScreen(mainScreen);
        }
        
        // Показать определенный экран
        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            screen.classList.add('active');
        }
        
        // Генерация ID комнаты
        function generateRoomId() {
            return Math.random().toString(36).substring(2, 10).toUpperCase();
        }
        
        // Извлечение ID комнаты из URL
        function extractRoomIdFromUrl(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.searchParams.get('room');
            } catch (e) {
                return null;
            }
        }
        
        // Инициализация при загрузке
        window.addEventListener('load', init);
    </script>
</body>
</html>
